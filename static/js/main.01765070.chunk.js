(this["webpackJsonpreact-js"]=this["webpackJsonpreact-js"]||[]).push([[0],{199:function(t,n,e){"use strict";e.r(n);var i=e(0),o=e.n(i),r=e(75),a=e.n(r),c=(e(85),e(86),e(87),e(88),e(6)),s=e(12),l=e(1),u=e.n(l),d=e(80),g=e(17),v=e(3),f=function(t){var n,e,o,r,a,c,s,l,f,h=t.points,p=t.onChangeColor,b=t.index,x=t.onPickerButton;f=h[b].colour.hex?h[b].colour.hex:h[b].colour;var m=u()({default:{container:{left:h[b].currentXY.x,top:h[b].currentXY.y},pointContainer:{display:"flex",justifyContent:"center",alignItems:"center",height:"36px",width:"36px",flexWrap:"nowrap"},point_unclicked:{backgroundColor:f,":hover":{width:"35px",height:"35px",cursor:"pointer",borderWidth:"8px"}},point_clicked:{backgroundColor:f},radius:{width:(null===(n=h[b].tags)||void 0===n?void 0:n.showRadius)?2*h[b].radius+50+"px":"0px",height:(null===(e=h[b].tags)||void 0===e?void 0:e.showRadius)?2*h[b].radius+50+"px":"0px",transition:(null===(o=h[b].tags)||void 0===o?void 0:o.resizing)?"all 0s cubic-bezier(0.39, 0.58, 0.57, 1)":"all 0.3s cubic-bezier(0.39, 0.58, 0.57, 1)"},pickerButton:{width:(null===(r=h[b].tags)||void 0===r?void 0:r.clicked)?"30px":"0px",height:(null===(a=h[b].tags)||void 0===a?void 0:a.clicked)?"30px":"0px",fontSize:"12pt",transform:(null===(c=h[b].tags)||void 0===c?void 0:c.clicked)?(null===(s=h[b].tags)||void 0===s?void 0:s.showRadius)?"translate(-50%, calc(-40px - ".concat(h[b].radius+25,"px))"):"translate(-50%, -60px)":"translate(-50%, -50%)",transition:(null===(l=h[b].tags)||void 0===l?void 0:l.resizing)?"all 0s cubic-bezier(0.39, 0.58, 0.57, 1)":"all 0.3s cubic-bezier(0.39, 0.58, 0.57, 1)",color:f},pickerBar:{position:"fixed",transform:"translate(calc(-50% + 18px), calc(2px+".concat(h[b].radius+25,"))")}}});return h[b].pointRef=Object(i.useRef)(),h[b].containerRef=Object(i.useRef)(),Object(v.jsxs)("div",{className:"dragIContainer",style:m.container,ref:h[b].containerRef,children:[Object(v.jsx)("div",{style:m.pointContainer,children:Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{className:"dragColor",style:m.pickerButton,onClick:function(t){return x(b)},children:Object(v.jsx)(g.c,{})}),Object(v.jsx)("div",{style:m.radius,className:"dragIWeight",id:h[b].id}),Object(v.jsx)("div",{ref:h[b].pointRef,style:m.point_unclicked,className:"dragItem"+(h[b].tags&&(h[b].tags.active||h[b].tags.clicked)?" active":""),id:h[b].id})]})}),h[b].tags&&h[b].tags.showPicker&&Object(v.jsx)(d.a,{style:m.pickerBar,color:f,onChange:function(t){return p(b,t)},disableAlpha:!0,presetColors:[]})]})};f.defaultProps={className:"dragItem"};var h=f,p=function(t){var n=t.points,e=t.onChangeColor,o=t.onRender,r=t.onPickerButton;Object(i.useEffect)((function(){o()}));var a=[];for(var c in n)a.push(Object(v.jsx)(h,{points:n,index:c,onChangeColor:e,onPickerButton:r}));return a},b=e(198);function x(t){console&&(console.error?console.error(t):console.log&&console.log(t))}var m=/ERROR:\s*\d+:(\d+)/gi;function j(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=Object(c.a)(n.matchAll(m)),i=new Map(e.map((function(t,i){var o=parseInt(t[1]),r=e[i+1],a=r?r.index:n.length;return[o-1,n.substring(t.index,a)]})));return t.split("\n").map((function(t,n){var e=i.get(n);return"".concat(n+1,": ").concat(t).concat(e?"\n\n^^^ ".concat(e):"")})).join("\n")}function k(t,n,e,i){var o=i||x,r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS)){var a=t.getShaderInfoLog(r);return o("Error compiling shader: ".concat(a,"\n").concat(j(n,a))),t.deleteShader(r),null}return r}function R(t,n,e,i,o){var r=o||x,a=t.createProgram();if(n.forEach((function(n){t.attachShader(a,n)})),e&&e.forEach((function(n,e){t.bindAttribLocation(a,i?i[e]:e,n)})),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS)){var c=t.getProgramInfoLog(a);return r("Error in program linking: ".concat(c,"\n").concat(n.map((function(n){var e=j(t.getShaderSource(n)),i=t.getShaderParameter(n,t.SHADER_TYPE);return"".concat(b.glEnumToString(t,i),":\n").concat(e)})).join("\n"))),t.deleteProgram(a),null}return a}var w=["VERTEX_SHADER","FRAGMENT_SHADER"];var y=function(t,n,e,i,o){for(var r=[],a=0;a<n.length;++a)r.push(k(t,n[a],t[w[a]],o));return R(t,r,e,i,o)},O=function(t,n){if(t&&t.length>0){var e=n.getContext("webgl2");n.width=n.offsetWidth,n.height=n.offsetHeight;var i=y(e,["#version 300 es\n    in vec2 a_position;\n\n    uniform vec2 u_resolution;\n\n    out vec2 v_position;\n\n    void main(){\n        gl_Position = vec4(a_position/u_resolution * 2.0 - 1.0, 0, 1);\n        v_position = vec2(a_position.x, u_resolution.y-a_position.y);\n    }\n    ",(p=t.length,"#version 300 es\n    precision highp float;\n\n    in vec2 v_position;\n\n    uniform vec2 u_resolution;\n    uniform ivec2 pointsXY[".concat(p,"];\n    uniform float pointsRadius[").concat(p,"];\n    uniform vec3 pointsRGB[").concat(p,"];\n    uniform vec3 pointsHSV[").concat(p,"];\n\n    out vec4 outColor;\n\n    vec2 minMax(vec3 rgb){\n        vec2 mM = vec2(rgb[0], rgb[0]);\n        for(int i=1;i<3;i++){\n            if (rgb[i] < mM[0])\n                mM[0] = rgb[i];\n            if (rgb[i] > mM[1])\n                mM[1] = rgb[i];\n        }\n        return mM;\n    }\n\n    float rgbToHue(vec3 rgb){\n        float hue=0.0, C;\n        vec2 mM = minMax(rgb);\n        C = mM[1] - mM[0];\n        if(C==0.0){\n        }else if(mM[1]==rgb[0]){\n            hue = mod((rgb[1] - rgb[2]) / C, 6.0);\n        }else if(mM[1]==rgb[1]){\n            hue =     (rgb[2] - rgb[0]) / C + 2.0;\n        }else if(mM[1]==rgb[2]){\n            hue =     (rgb[0] - rgb[1]) / C + 4.0;\n        }\n        hue = mod((mod(hue * 60.0, 360.0) + 360.0), 360.0);\n        return hue;\n    }\n\n    float f(int n, vec3 hsv){\n        float k;\n        k = mod((float(n) + hsv[0] / 60.0), 6.0);\n        float fOut=hsv[2] - hsv[2] * hsv[1] * max(0.0, min(min(k, 4.0 - k), 1.0));\n        return fOut;\n    }\n\n    vec3 hsvToRgb(vec3 hsv){\n        vec3 rgb = vec3(f(5,hsv), f(3,hsv), f(1,hsv));\n        return rgb;\n    }\n\n    float dist(ivec2 pos, ivec2 point){\n        return pow(pow(float(pos.x-point.x), 2.0)+pow(float(pos.y-point.y), 2.0), 0.5);\n    }\n\n    void main(){\n        // ivec2 position = ivec2((v_position + 1.0) / 2.0 * u_resolution);\n        ivec2 position = ivec2(v_position);\n        float invSum = 0.0;\n        vec3 hsv = vec3(0,0,0), rgb = vec3(0,0,0);\n        int pointCentre = -1;\n        for(int i=0;i<").concat(p,";i++){\n            float d = dist(pointsXY[i], position);\n            if(abs(d)>0.0000001){\n                // float invD = 1.0*pow(float(i+1), 1.0)/d;\n                // float invD = (1.0+pointsRadius[i]/10.0)/d;\n                float invD = (1.0+pointsRadius[i]/10.0)/d;\n                // invD = invD* (1.0+pointsRadius[i]/10.0);\n                // invD = pow(1.0/d, (1.0+pointsRadius[i]/10.0));\n                hsv += invD * pointsHSV[i];\n                rgb += invD * pointsRGB[i];\n                invSum += invD;\n            }else{\n                pointCentre=i;\n            }\n        }\n        if(pointCentre == -1){\n            hsv = hsv/invSum;\n            rgb = rgb/invSum;\n            hsv[0] = rgbToHue(rgb);\n            outColor = vec4(hsvToRgb(hsv),1);\n        }else{\n            hsv = pointsHSV[pointCentre];\n            rgb = pointsRGB[pointCentre];\n            outColor = vec4(rgb, 1);\n        }\n    }\n\n    "))]),o={position:e.getAttribLocation(i,"a_position"),resolution:e.getUniformLocation(i,"u_resolution"),pointsRadius:e.getUniformLocation(i,"pointsRadius"),pointsXY:e.getUniformLocation(i,"pointsXY"),pointsRGB:e.getUniformLocation(i,"pointsRGB"),pointsHSV:e.getUniformLocation(i,"pointsHSV")},r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);var a=[0,n.height,n.width,0,n.width,n.height,0,0,n.width,0,0,n.height];e.bufferData(e.ARRAY_BUFFER,new Float32Array(a),e.STATIC_DRAW);var c=e.createVertexArray();e.bindVertexArray(c),e.enableVertexAttribArray(o.position);var s=e.FLOAT,l=0;e.vertexAttribPointer(o.position,2,s,!1,0,l),function(t,n){n=n||1;var e=t.clientWidth*n|0,i=t.clientHeight*n|0;(t.width!==e||t.height!==i)&&(t.width=e,t.height=i)}(e.canvas),e.viewport(0,0,e.canvas.width,e.canvas.height),e.useProgram(i);var u=t.map((function(t){return t.radius})),d=t.map((function(t){return[t.x,t.y]})),g=t.map((function(t){var n=t.colour;return[n.rgb.r/255,n.rgb.g/255,n.rgb.b/255]})),v=t.map((function(t){var n=t.colour;return[n.hsv.h/360,n.hsv.s,n.hsv.v]}));e.uniform1fv(o.pointsRadius,u.flat()),e.uniform2iv(o.pointsXY,d.flat()),e.uniform3fv(o.pointsRGB,g.flat()),e.uniform3fv(o.pointsHSV,v.flat()),e.uniform2f(o.resolution,n.width,n.height);var f=e.TRIANGLES;l=0;var h=a.length/2;e.drawArrays(f,l,h)}var p},C=new window.Worker("./gradientWorker.js"),M=function(t){var n=t.id,e=t.canvasPoints,o=Object(i.useState)(e),r=Object(s.a)(o,2),a=r[0],c=r[1],l=Object(i.useState)(Object(i.useRef)(null)),u=Object(s.a)(l,1)[0],d=function t(n){u.current.getContext("2d").putImageData(n,0,0),window.requestAnimationFrame((function(){return t(n)}))},g=function(){if(u.current.getContext("webgl2"))window.requestAnimationFrame((function(){return O(a,u.current)}));else{console.log("WebGL2 not available, using CPU.");var t=u.current.getContext("2d").createImageData(u.current.width,u.current.height),n=t.data.length;C.terminate(),(C=new window.Worker("./gradientWorker.js")).postMessage({imageData:t,points:a,canvas:{width:u.current.width,height:u.current.height}}),C.onerror=function(t){console.log("error",t)},C.onmessage=function(t){n===t.data.imageData.data.length&&window.requestAnimationFrame((function(){return d(t.data.imageData)}))}}};return Object(i.useEffect)((function(){c(e),g()})),Object(i.useEffect)((function(){u.current.getContext("webgl2")||alert("WebGL not available in this browser/platform. Renders may be slower.")}),[]),Object(v.jsx)("canvas",{id:n,ref:u})};var S=function(){var t=Object(i.useState)({down:!1,clicked:{status:!1,index:void 0,obj:void 0},active:!1,resizing:{mode:!1,start:!1},target:{obj:void 0,index:void 0,initialPosition:{x:0,y:0},initialRadius:void 0},pos:{start:{x:0,y:0},middle:{x:0,y:0},end:{x:0,y:0}}}),n=Object(s.a)(t,2),e=n[0],o=n[1],r=function(t){var n,e,i,o,r,a,c=[t.r,t.g,t.b];0===(i=(n=Math.max.apply(Math,c))-(e=Math.min.apply(Math,c)))?o=0:n===c[0]?o=(c[1]-c[2])/i%6:n===c[1]?o=(c[2]-c[0])/i+2:n===c[2]&&(o=(c[0]-c[1])/i+4);var s={h:o=((o*=60)%360+360)%360,s:0===(r=n/255)?0:i/(255*r),v:r,a:1},l={h:o,s:1===(a=(n+e)/510)||0===a?0:i/(255*(1-Math.abs(2*a-1))),l:a,a:1};t.a=1;var u="#";for(var d in c){var g=Math.floor(c[d]).toString(16);u+="0".repeat(2-g.length)+g}return{rgb:t,hsv:s,hsl:l,hex:u}},a=r({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()}),l=Object(i.useState)([{pointRef:null,containerRef:null,radius:0,colour:a,showPicker:!1,currentXY:{x:50,y:50},size:void 0,containerSize:void 0}]),u=Object(s.a)(l,2),d=u[0],f=u[1],h=function(t){var n=[[0,0,0],[0,0,0]];return n[0]=[t.hsv.h,t.hsv.s,t.hsv.v],n[1]=[t.rgb.r,t.rgb.g,t.rgb.b],n},b=Object(i.useState)(!1),x=Object(s.a)(b,2),m=x[0],j=x[1],k=function(t){var n;e.down=!0,"touch"===t.type.substr(0,5)?e.pos.start={x:t.touches[0].clientX,y:t.touches[0].clientY}:e.pos.start={x:t.clientX,y:t.clientY},e.pos.end=e.pos.start,e.target.obj=document.elementFromPoint(t.clientX,t.clientY);var i=R(e.target.obj);e.target.index=i,e.target.obj.classList.contains("dragItem")&&(!e.clicked.status||e.clicked.status&&e.clicked.index!==e.target.index)?(O(),i&&(e.target.index=i,e.target.init={x:d[e.target.index].currentXY.x-e.pos.start.x,y:d[e.target.index].currentXY.y-e.pos.start.y},e.active=!0,d[e.target.index].tags={active:!0},d[e.target.index].containerRef.current.style.zIndex=2)):e.clicked.status&&e.clicked.index===e.target.index&&(null===(n=d[e.clicked.index].tags)||void 0===n?void 0:n.showRadius)&&(e.resizing.mode=!0,e.target.initialRadius=d[e.clicked.index].radius,console.log("hi resize")),f(Object(c.a)(d)),o(e)},R=function(t){for(var n in d)if(d[n].pointRef.current===t)return n},w=function(t){return{x:d[t].currentXY.x+d[t].containerSize[0]/2,y:d[t].currentXY.y+d[t].containerSize[1]/2}},y=function(t){var n=[[-(d[t].containerSize[0]-d[t].size[0])/2,-(d[t].containerSize[1]-d[t].size[1])/2],[0,0]];return n[1]=[n[0][0]+d[t].containerRef.current.parentNode.clientWidth-d[t].size[0],n[0][1]+d[t].containerRef.current.parentNode.clientHeight-d[t].size[1]],n},O=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;for(var n in!t&&(e.clicked.status=!1),d)t!==n&&(d[n].tags&&delete d[n].tags,d[n].containerRef.current.style.zIndex=1);f(d)},C=function(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))},S=function(t,n){return C(n,t)<=5};return Object(i.useEffect)((function(){!function(t){var n=new Array(d.length);for(var e in d)d[e].size&&(n[e]={x:d[e].currentXY.x+d[e].size[0]/2,y:d[e].currentXY.y+d[e].size[1]/2,colour:d[e].colour,colourArr:h(d[e].colour),radius:d[e].radius});if(!t)return n;j(n)}(!0)}),[d]),Object(i.useEffect)((function(){console.log("tT",e)}),[]),Object(v.jsx)("div",{className:"App",onPointerDown:function(t){return k(t)},onPointerMove:function(t){return function(t){if("touch"===t.type.substr(0,5)?e.pos.middle={x:t.touches[0].clientX,y:t.touches[0].clientY}:e.pos.middle={x:t.clientX,y:t.clientY},e.active&&!S(e.pos.start,e.pos.middle)){t.preventDefault();var n=e.target.index;d[n].containerRef.current.style.zIndex=2;var i={x:0,y:0};i.x=e.pos.middle.x+e.target.init.x,i.y=e.pos.middle.y+e.target.init.y;var r=y(n);d[n].currentXY.x=Math.max(Math.min(i.x,r[1][0]),r[0][0]),d[n].currentXY.y=Math.max(Math.min(i.y,r[1][1]),r[0][1])}else if(e.resizing.mode){console.log("point is at ",w(e.clicked.index));var a=C(w(e.clicked.index),{x:e.pos.middle.x-20,y:e.pos.middle.y-20});console.log(a-25,e.target.initialRadius),e.resizing.start?(d[e.clicked.index].radius=Math.max(Math.abs(a)-25,0),console.log(Math.abs(a),d[e.clicked.index].radius)):a-25>=e.target.initialRadius&&(d[e.clicked.index].tags?d[e.clicked.index].tags.resizing=!0:d[e.clicked.index].tags={resizing:!0},e.resizing.start=!0)}else e.down&&k(t);f(Object(c.a)(d)),o(e)}(t)},onPointerUp:function(t){return function(t){"touch"===t.type.substr(0,5)?e.pos.end={x:t.touches[0].clientX,y:t.touches[0].clientY}:e.pos.end={x:t.clientX,y:t.clientY};var n=e.target.index,i=document.elementFromPoint(t.clientX,t.clientY);S(e.pos.start,e.pos.end)&&(i.classList.contains("dragItem")||i.classList.contains("dragIWeight"))?(console.log("Hello click"),d[n].containerRef.current.style.zIndex=d[n].clicked?1:2,!e.clicked.status||e.clicked.target&&e.clicked.target!==i?(e.clicked.status=!0,e.clicked.target=i,e.clicked.index=R(i),O(e.clicked.index),d[e.clicked.index].tags={clicked:!0,showRadius:!0}):e.clicked.target&&e.clicked.target===i&&(e.clicked.status=!1,O(),e.clicked.target=void 0,e.clicked.index=void 0)):e.resizing.start?(console.log("hello resize"),delete d[n].tags.resizing):e.active&&(console.log("hello active fello, go to sleep"),O(),e.active=!1,d[n].containerRef.current.style.zIndex=1),e.down=!1,e.active=!1,e.resizing.mode=!1,e.resizing.start=!1,f(Object(c.a)(d)),o(e)}(t)},children:Object(v.jsxs)("div",{id:"outerContainer",children:[Object(v.jsx)("div",{id:"dragPalette",children:Object(v.jsx)(M,{id:"gradientPalette",canvasPoints:m})}),Object(v.jsx)(p,{points:d,onRender:function(){var t=!1;for(var n in d)d[n].size||(t=!0,d[n].size=[d[n].pointRef.current.offsetWidth,d[n].pointRef.current.offsetHeight],d[n].containerSize=[d[n].pointRef.current.parentNode.parentNode.offsetWidth,d[n].pointRef.current.parentNode.parentNode.offsetHeight]);t&&f(d)},onChangeColor:function(t,n){var e=Object(c.a)(d);e[t].colour=n,f(Object(c.a)(e))},onPickerButton:function(t){d[t].tags?d[t].tags.showPicker?(delete d[t].tags.showPicker,d[t].tags.showRadius=!0):(d[t].tags.showPicker=!0,delete d[t].tags.showRadius):d[t].tags={showPicker:!0},f(Object(c.a)(d))}}),Object(v.jsxs)("div",{id:"point-manager",children:[Object(v.jsx)("button",{className:"button plus",onClick:function(){var t,n={x:50,y:50};if(d.length>0){var e=[[0,0],[0,0]];e[1]=[e[0][0]+d[0].containerRef.current.parentNode.clientWidth-d[0].size[0],e[0][1]+d[0].containerRef.current.parentNode.clientHeight-d[0].size[1]],n={x:Math.floor(Math.random()*e[1][0]+e[0][0]),y:Math.floor(Math.random()*e[1][1]+e[0][1])}}t={r:255*Math.random(),g:255*Math.random(),b:255*Math.random()};var i={ref:null,containerRef:null,radius:0,colour:t=r(t),showPicker:!1,pointerOffset:{x:0,y:0},currentXY:n,size:void 0,containerSize:void 0};f([].concat(Object(c.a)(d),[i]))},children:Object(v.jsx)(g.b,{})}),Object(v.jsx)("button",{className:"button minus",onClick:function(){return function(t){var n=t.index;-1===n&&(n=d.length-1),console.log("Removing point with key "+n);var e=d;e.splice(n,1),f(Object(c.a)(e)),console.log("New points are ",d)}({index:-1})},children:Object(v.jsx)(g.a,{})})]})]})})},z=function(t){t&&t instanceof Function&&e.e(3).then(e.bind(null,201)).then((function(n){var e=n.getCLS,i=n.getFID,o=n.getFCP,r=n.getLCP,a=n.getTTFB;e(t),i(t),o(t),r(t),a(t)}))};a.a.render(Object(v.jsx)(o.a.StrictMode,{children:Object(v.jsx)(S,{})}),document.getElementById("root")),z()},85:function(t,n,e){},86:function(t,n,e){},87:function(t,n,e){},88:function(t,n,e){}},[[199,1,2]]]);
//# sourceMappingURL=main.01765070.chunk.js.map