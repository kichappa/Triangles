(this["webpackJsonpreact-js"]=this["webpackJsonpreact-js"]||[]).push([[0],{198:function(n,t,e){"use strict";e.r(t);var r=e(0),o=e.n(r),i=e(74),a=e.n(i),c=(e(84),e(85),e(86),e(87),e(7)),s=e(12),u=e(1),f=e.n(u),l=e(79),v=e(3),h=function(n){var t,e=n.points,o=n.onChangeColor,i=n.index;t=e[i].colour.hex?e[i].colour.hex:e[i].colour;var a=f()({default:{container:{left:e[i].currentXY.x,top:e[i].currentXY.y},pointContainer:{display:"flex",justifyContent:"center",alignItems:"center",height:"36px",width:"36px",flexWrap:"nowrap"},point:{backgroundColor:t},picker:{}}});return e[i].pointRef=Object(r.useRef)(),e[i].containerRef=Object(r.useRef)(),Object(v.jsxs)("div",{className:"dragIContainer",style:a.container,ref:e[i].containerRef,children:[Object(v.jsx)("div",{style:a.pointContainer,children:Object(v.jsx)("div",{ref:e[i].pointRef,style:a.point,className:"dragItem",id:e[i].id})}),e[i].showPicker&&Object(v.jsx)(l.a,{style:{position:"fixed"},color:t,onChange:function(n){return o(i,n)},disableAlpha:!0,presetColors:[]})]})};h.defaultProps={className:"dragItem"};var g=h,d=function(n){var t=n.points,e=n.onChangeColor,o=n.onRender;Object(r.useEffect)((function(){o()}));var i=[];for(var a in t)i.push(Object(v.jsx)(g,{points:t,index:a,onChangeColor:e}));return i},p=e(197);function m(n){console&&(console.error?console.error(n):console.log&&console.log(n))}var b=/ERROR:\s*\d+:(\d+)/gi;function x(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=Object(c.a)(t.matchAll(b)),r=new Map(e.map((function(n,r){var o=parseInt(n[1]),i=e[r+1],a=i?i.index:t.length;return[o-1,t.substring(n.index,a)]})));return n.split("\n").map((function(n,t){var e=r.get(t);return"".concat(t+1,": ").concat(n).concat(e?"\n\n^^^ ".concat(e):"")})).join("\n")}function j(n,t,e,r){var o=r||m,i=n.createShader(e);if(n.shaderSource(i,t),n.compileShader(i),!n.getShaderParameter(i,n.COMPILE_STATUS)){var a=n.getShaderInfoLog(i);return o("Error compiling shader: ".concat(a,"\n").concat(x(t,a))),n.deleteShader(i),null}return i}function y(n,t,e,r,o){var i=o||m,a=n.createProgram();if(t.forEach((function(t){n.attachShader(a,t)})),e&&e.forEach((function(t,e){n.bindAttribLocation(a,r?r[e]:e,t)})),n.linkProgram(a),!n.getProgramParameter(a,n.LINK_STATUS)){var c=n.getProgramInfoLog(a);return i("Error in program linking: ".concat(c,"\n").concat(t.map((function(t){var e=x(n.getShaderSource(t)),r=n.getShaderParameter(t,n.SHADER_TYPE);return"".concat(p.glEnumToString(n,r),":\n").concat(e)})).join("\n"))),n.deleteProgram(a),null}return a}var w=["VERTEX_SHADER","FRAGMENT_SHADER"];var R=function(n,t,e,r,o){for(var i=[],a=0;a<t.length;++a)i.push(j(n,t[a],n[w[a]],o));return y(n,i,e,r,o)},O=function n(t,e){if(t&&t.length>0){var r=e.getContext("webgl2");e.width=e.offsetWidth,e.height=e.offsetHeight;var o=R(r,["#version 300 es\n    in vec2 a_position;\n\n    uniform vec2 u_resolution;\n\n    out vec2 v_position;\n\n    void main(){\n        gl_Position = vec4(a_position/u_resolution * 2.0 - 1.0, 0, 1);\n        v_position = vec2(a_position.x, u_resolution.y-a_position.y);\n    }\n    ",(p=t.length,"#version 300 es\n    precision highp float;\n\n    in vec2 v_position;\n\n    uniform vec2 u_resolution;\n    uniform ivec2 pointsXY[".concat(p,"];\n    uniform vec3 pointsRGB[").concat(p,"];\n    uniform vec3 pointsHSV[").concat(p,"];\n\n    out vec4 outColor;\n\n    vec2 minMax(vec3 rgb){\n        vec2 mM = vec2(rgb[0], rgb[0]);\n        for(int i=1;i<3;i++){\n            if (rgb[i] < mM[0])\n                mM[0] = rgb[i];\n            if (rgb[i] > mM[1])\n                mM[1] = rgb[i];\n        }\n        return mM;\n    }\n\n    float rgbToHue(vec3 rgb){\n        float hue=0.0, C;\n        vec2 mM = minMax(rgb);\n        C = mM[1] - mM[0];\n        if(C==0.0){\n        }else if(mM[1]==rgb[0]){\n            hue = mod((rgb[1] - rgb[2]) / C, 6.0);\n        }else if(mM[1]==rgb[1]){\n            hue =     (rgb[2] - rgb[0]) / C + 2.0;\n        }else if(mM[1]==rgb[2]){\n            hue =     (rgb[0] - rgb[1]) / C + 4.0;\n        }\n        hue = mod((mod(hue * 60.0, 360.0) + 360.0), 360.0);\n        return hue;\n    }\n\n    float f(int n, vec3 hsv){\n        float k;\n        k = mod((float(n) + hsv[0] / 60.0), 6.0);\n        float fOut=hsv[2] - hsv[2] * hsv[1] * max(0.0, min(min(k, 4.0 - k), 1.0));\n        return fOut;\n    }\n\n    vec3 hsvToRgb(vec3 hsv){\n        vec3 rgb = vec3(f(5,hsv), f(3,hsv), f(1,hsv));\n        return rgb;\n    }\n\n    float dist(ivec2 pos, ivec2 point){\n        return pow(pow(float(pos.x-point.x), 2.0)+pow(float(pos.y-point.y), 2.0), 0.5);\n    }\n\n    void main(){\n        // ivec2 position = ivec2((v_position + 1.0) / 2.0 * u_resolution);\n        ivec2 position = ivec2(v_position);\n        float invSum = 0.0;\n        vec3 hsv = vec3(0,0,0), rgb = vec3(0,0,0);\n        int pointCentre = -1;\n        for(int i=0;i<").concat(p,";i++){\n            float d = dist(pointsXY[i], position);\n            if(abs(d)>0.0000001){\n                float invD = 1.0/d;\n                hsv += invD * pointsHSV[i];\n                rgb += invD * pointsRGB[i];\n                invSum += invD;\n            }else{\n                pointCentre=i;\n            }\n        }\n        if(pointCentre == -1){\n            hsv = hsv/invSum;\n            rgb = rgb/invSum;\n            hsv[0] = rgbToHue(rgb);\n            outColor = vec4(hsvToRgb(hsv),1);\n        }else{\n            hsv = pointsHSV[pointCentre];\n            rgb = pointsRGB[pointCentre];\n            outColor = vec4(rgb, 1);\n        }\n    }\n\n    "))]),i={position:r.getAttribLocation(o,"a_position"),resolution:r.getUniformLocation(o,"u_resolution"),pointsXY:r.getUniformLocation(o,"pointsXY"),pointsRGB:r.getUniformLocation(o,"pointsRGB"),pointsHSV:r.getUniformLocation(o,"pointsHSV")},a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a);var c=[0,e.height,e.width,0,e.width,e.height,0,0,e.width,0,0,e.height];r.bufferData(r.ARRAY_BUFFER,new Float32Array(c),r.STATIC_DRAW);var s=r.createVertexArray();r.bindVertexArray(s),r.enableVertexAttribArray(i.position);var u=r.FLOAT,f=0;r.vertexAttribPointer(i.position,2,u,!1,0,f),function(n,t){t=t||1;var e=n.clientWidth*t|0,r=n.clientHeight*t|0;(n.width!==e||n.height!==r)&&(n.width=e,n.height=r)}(r.canvas),r.viewport(0,0,r.canvas.width,r.canvas.height),r.useProgram(o);var l=t.map((function(n){return[n.x,n.y]})),v=t.map((function(n){var t=n.colour;return[t.rgb.r/255,t.rgb.g/255,t.rgb.b/255]})),h=t.map((function(n){var t=n.colour;return[t.hsv.h/360,t.hsv.s,t.hsv.v]}));r.uniform2iv(i.pointsXY,l.flat()),r.uniform3fv(i.pointsRGB,v.flat()),r.uniform3fv(i.pointsHSV,h.flat()),r.uniform2f(i.resolution,e.width,e.height);var g=r.TRIANGLES;f=0;var d=c.length/2;r.drawArrays(g,f,d),requestAnimationFrame(n)}var p},M=new window.Worker("./gradientWorker.js"),C=function(n){var t=n.id,e=n.canvasPoints,o=Object(r.useState)(e),i=Object(s.a)(o,2),a=i[0],c=i[1],u=Object(r.useState)(Object(r.useRef)(null)),f=Object(s.a)(u,1)[0],l=function n(t){f.current.getContext("2d").putImageData(t,0,0),window.requestAnimationFrame((function(){return n(t)}))},h=function(){if(f.current.getContext("webgl2"))window.requestAnimationFrame((function(){return O(a,f.current)}));else{var n=f.current.getContext("2d").createImageData(f.current.width,f.current.height),t=n.data.length;M.terminate(),(M=new window.Worker("./gradientWorker.js")).postMessage({imageData:n,points:a,canvas:{width:f.current.width,height:f.current.height}}),M.onerror=function(n){console.log("error",n)},M.onmessage=function(n){t===n.data.imageData.data.length&&window.requestAnimationFrame((function(){return l(n.data.imageData)}))}}};return Object(r.useEffect)((function(){c(e),h()}),[e]),Object(r.useEffect)((function(){f.current.getContext("webgl2")||alert("WebGL not available in this browser/platform. Renders may be slower.")}),[]),Object(v.jsx)("canvas",{id:t,ref:f})};var S=function(){var n=Object(r.useState)([{mouseDown:!1,start:{x:0,y:0},end:{x:0,y:0}}]),t=Object(s.a)(n,2),e=t[0],o=t[1],i=function(n){var t,e,r,o,i,a,c=[n.r,n.g,n.b];0===(r=(t=Math.max.apply(Math,c))-(e=Math.min.apply(Math,c)))?o=0:t===c[0]?o=(c[1]-c[2])/r%6:t===c[1]?o=(c[2]-c[0])/r+2:t===c[2]&&(o=(c[0]-c[1])/r+4);var s={h:o=((o*=60)%360+360)%360,s:0===(i=t/255)?0:r/(255*i),v:i,a:1},u={h:o,s:1===(a=(t+e)/510)||0===a?0:r/(255*(1-Math.abs(2*a-1))),l:a,a:1};n.a=1;var f="#";for(var l in c){var v=Math.floor(c[l]).toString(16);f+="0".repeat(2-v.length)+v}return{rgb:n,hsv:s,hsl:u,hex:f}},a=i({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()}),u=Object(r.useState)([{pointRef:null,containerRef:null,active:!1,colour:a,showPicker:!1,pointerOffset:{x:0,y:0},currentXY:{x:50,y:50},size:!1}]),f=Object(s.a)(u,2),l=f[0],h=f[1],g=function(n){var t=[[0,0,0],[0,0,0]];return t[0]=[n.hsv.h,n.hsv.s,n.hsv.v],t[1]=[n.rgb.r,n.rgb.g,n.rgb.b],t},p=Object(r.useState)(!1),m=Object(s.a)(p,2),b=m[0],x=m[1],j=function(n){e.mouseDown=!0,o(e);var t=document.elementFromPoint(n.clientX,n.clientY);if(t.classList.contains("dragItem")){var r;for(var i in l)l[i].pointRef.current===t&&(r=i);console.log("dragStart "+r,l[r]);var a={x:0,y:0};a="touch"===n.type.substr(0,5)?{x:n.touches[0].clientX,y:n.touches[0].clientY}:{x:n.clientX,y:n.clientY},e.start=a,e.end=a,o(e),l[r].pointerOffset.x=a.x-l[r].currentXY.x,l[r].pointerOffset.y=a.y-l[r].currentXY.y,l[r].active=!0,l[r].pointRef.current.classList.add("active"),l[r].containerRef.current.style.zIndex=1,h(Object(c.a)(l))}},y=function(n){for(var t in l)l[t].showPicker=!1,l[t].pointRef.current.classList.remove("active"),l[t].containerRef.current.style.zIndex=1;l[n].pointRef.current.classList.add("active"),l[n].pointRef.current.parentNode.style.zIndex=2,h(l)},w=function(){var n=!1;for(var t in l)n=n||l[t].active;return n},R=function(n,t){n.showPicker=t},O=function(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))<=5};return Object(r.useEffect)((function(){!function(n){var t=new Array(l.length);for(var e in l)l[e].size&&(t[e]={x:l[e].currentXY.x+l[e].size[0]/2,y:l[e].currentXY.y+l[e].size[1]/2,colour:l[e].colour,colourArr:g(l[e].colour)});if(!n)return t;x(t)}(!0)}),[l]),Object(v.jsx)("div",{className:"App",onPointerDown:function(n){return j(n)},onPointerMove:function(n){return function(n){if(w()){var t;for(var r in l)l[r].active&&(t=r);n.preventDefault();var i={x:0,y:0};if(i="touch"===n.type.substr(0,5)?{x:n.touches[0].clientX,y:n.touches[0].clientY}:{x:n.clientX,y:n.clientY},e.end=i,o(e),!O(e.start,e.end)){R(l[t],!1),y(t);var a={x:0,y:0};a.x=i.x-l[t].pointerOffset.x,a.y=i.y-l[t].pointerOffset.y;var s=[[0,0],[0,0]];s[1]=[s[0][0]+l[t].containerRef.current.parentNode.clientWidth-l[t].size[0],s[0][1]+l[t].containerRef.current.parentNode.clientHeight-l[t].size[1]],l[t].currentXY.x=Math.max(Math.min(a.x,s[1][0]),s[0][0]),l[t].currentXY.y=Math.max(Math.min(a.y,s[1][1]),s[0][1]),h(Object(c.a)(l))}}else e.mouseDown&&j(n)}(n)},onPointerUp:function(n){return function(n){var t;for(var r in e.mouseDown=!1,o(e),l)l[r].active&&(t=r);t&&(l[t].pointerOffset.x=l[t].currentXY.x,l[t].pointerOffset.y=l[t].currentXY.y,l[t].active=!1,O(e.start,e.end)&&!l[t].showPicker?(y(t),l[t].pointRef.current.classList.add("active"),l[t].containerRef.current.style.zIndex=2,R(l[t],!0)):(l[t].pointRef.current.classList.remove("active"),R(l[t],!1),l[t].containerRef.current.style.zIndex=1),console.log("dragEnd "+t,l[t]),h(Object(c.a)(l)))}()},children:Object(v.jsxs)("div",{id:"outerContainer",children:[Object(v.jsx)("div",{id:"dragPalette",children:Object(v.jsx)(C,{id:"gradientPalette",canvasPoints:b})}),Object(v.jsx)(d,{points:l,onRender:function(){var n=!1;for(var t in l)l[t].size||(n=!0,l[t].size=[l[t].pointRef.current.offsetWidth,l[t].pointRef.current.offsetHeight]);n&&h(l)},onChangeColor:function(n,t){var e=Object(c.a)(l);e[n].colour=t,h(Object(c.a)(e))}}),Object(v.jsxs)("div",{id:"point-manager",children:[Object(v.jsx)("button",{className:"button plus",onClick:function(){var n,t={x:50,y:50};if(l.length>0){var e=[[0,0],[0,0]];e[1]=[e[0][0]+l[0].containerRef.current.parentNode.clientWidth-l[0].size[0],e[0][1]+l[0].containerRef.current.parentNode.clientHeight-l[0].size[1]],t={x:Math.floor(Math.random()*e[1][0]+e[0][0]),y:Math.floor(Math.random()*e[1][1]+e[0][1])}}n={r:255*Math.random(),g:255*Math.random(),b:255*Math.random()};var r={ref:null,containerRef:null,active:!1,colour:n=i(n),showPicker:!1,pointerOffset:{x:0,y:0},currentXY:t,size:!1};h([].concat(Object(c.a)(l),[r]))}}),Object(v.jsx)("button",{className:"button minus",onClick:function(){return function(n){var t=n.index;-1===t&&(t=l.length-1),console.log("Removing point with key "+t);var e=l;e.splice(t,1),h(Object(c.a)(e)),console.log("New points are ",l)}({index:-1})}})]})]})})},A=function(n){n&&n instanceof Function&&e.e(3).then(e.bind(null,200)).then((function(t){var e=t.getCLS,r=t.getFID,o=t.getFCP,i=t.getLCP,a=t.getTTFB;e(n),r(n),o(n),i(n),a(n)}))};a.a.render(Object(v.jsx)(o.a.StrictMode,{children:Object(v.jsx)(S,{})}),document.getElementById("root")),A()},84:function(n,t,e){},85:function(n,t,e){},86:function(n,t,e){},87:function(n,t,e){}},[[198,1,2]]]);
//# sourceMappingURL=main.b87e9b93.chunk.js.map